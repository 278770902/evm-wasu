(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{"9YrF":function(e,n,t){"use strict";t.r(n);var l=t("CcnG"),i=t("mrSG"),a=t("atIC"),r=t("lbwW"),o=t("B0rH"),u=t("6blF"),s=t("U3FM"),c=function(){function e(e,n){this.aumsService=e,this.logger=n}return e.prototype.upload=function(n,t,l){var i=this;return new u.a(function(a){var r=[],o={status:"start",data:[]};a.next(o);for(var u=n.length,s=function(u){var s=n[u];o.data[u]={status:"start",name:s.name},r[u]=i.aumsService.createImage({name:s.name,imgFile:s,userId:t,areaId:l}).subscribe(function(n){if(i.logger.debug(e.TAG+" upload() createImage response payload: "+JSON.stringify(n)),"success"===n.status){o.status="upload";var t=isNaN(+n.data.data)?0:+n.data.data;"finish"===n.data.state&&(t=100),Object.assign(o.data[u],{status:n.data.state,progress:t,id:n.data.data&&n.data.data&&n.data.data.data?n.data.data.data.id:null,url:n.data.data&&n.data.data&&n.data.data.data?n.data.data.data.url:null})}else Object.assign(o.data[u],{status:"error"});a.next(o),i.checkUploadComplete(o)&&(a.next(Object.assign(o,{status:"finish"})),a.complete())},function(e){Object.assign(o.data[u],{status:"error"}),a.next(o),i.checkUploadComplete(o)&&(a.next(Object.assign(o,{status:"finish"})),a.complete())})},c=0;c<u;c++)s(c);return function(){r.every(function(e){return e.unsubscribe()})}})},e.prototype.checkUploadComplete=function(e){return!Array.isArray(e.data)||!e.data.length||e.data.every(function(e){return"finish"===e.status||"error"===e.status})},e.TAG="UploadService",e.ngInjectableDef=l["ɵɵdefineInjectable"]({factory:function(){return new e(l["ɵɵinject"](r.a),l["ɵɵinject"](s.b))},token:e,providedIn:"root"}),e}(),d=t("O0u2"),p=t("ttWW"),h=t("eyyt"),g=t("1FC6"),f=t("h1wG"),m=t("TN67"),b=function(){function e(e,n,t,l,i,a,r,o,u,s,c,d){this.app=e,this.activatedRoute=n,this.aumsService=t,this.utils=l,this.uploadService=i,this.adminUserService=a,this.logger=r,this.componentFactoryResolver=o,this.alertCtrl=u,this.normalUserService=s,this.areaTreeService=c,this.router=d,this.blue=!1,this.placePhoto="assets/images/standard/publish-photos/publish-photo-default.png",this.isPublished=!1,this.publishAreaId=this.adminUserService.user.areaId,this.publishAreaName=this.adminUserService.user.areaName,this.gotoArea=!1,this.columnName=this.activatedRoute.snapshot.paramMap.get("columnName"),this.columnId=+this.activatedRoute.snapshot.paramMap.get("columnId"),this.websiteId=+this.activatedRoute.snapshot.paramMap.get("websiteId"),this.publishpower=+this.activatedRoute.snapshot.paramMap.get("publishpower");var p=+this.activatedRoute.snapshot.paramMap.get("articleId");p&&(this.articleId=p)}return Object.defineProperty(e.prototype,"placeSlide",{get:function(){return Object.assign({},{content:"",added:!1,url:"",imageid:0})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canDelete",{get:function(){return!!this.currentSlide&&this.currentSlide.added},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isChange",{get:function(){var e=this;return!!this.initializedModels&&this.models.some(function(n){if("slide"===n.type){if(!(r=e.initializedModels.find(function(e){return e.description===n.description})))return!0;var t=n.content,l=r.content;if(!Array.isArray(t)||!Array.isArray(l)||Array.isArray(t)&&t.length<2||Array.isArray(l)&&l.length<2)return!1;if(Array.isArray(t)&&t.length>1&&Array.isArray(l)&&l.length>1){var i,a=void 0;return t.length>l.length?(a=t,i=l):(a=l,i=t),a.some(function(e){var n=i.find(function(n){return n.id===e.id});return!n||n.content!==e.content||n.url!==e.url})}return!0}var r;return!(r=e.initializedModels.find(function(e){return e.description===n.description}))||("boolean"==typeof n.content?!!r.content!==n.content:r.content!==n.content)})},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var n=this;this.models=[{description:"图集标题",type:"text",role:"title"},{description:"是否推送",type:"toggle",role:"push"},{description:"是否公开",type:"toggle",role:"public"},{description:"图集",type:"slide",role:"slides",content:[]}],this.pageLoad(),!!this.app.getFeatureConfig("canSelectPublishArea")&&this.models.splice(1,0,{description:"发布区域",type:"text",role:"publishArea"}),this.app.appChannel.subscribe(function(t){t.type===g.a.SELECTAREA&&n.areaTreeService.businessType===m.a.ARTICLE_PUBLISH_AREA&&e.TAG===t.page&&(n.publishAreaId=t.data.areaId,n.publishAreaName=t.data.areaName)})},e.prototype.ngOnDestroy=function(){this.app.appChannel.unsubscribe()},e.prototype.canDeactivate=function(){return!!this.isPublished||!!this.gotoArea||!this.isChange||this.isSaveAlert()},e.prototype.pageLoad=function(){var e=this;this.loadArticle(function(){e.fillModels(),e.initializedModels=JSON.parse(JSON.stringify(e.models))})},e.prototype.ionSlideTransitionStart=function(e){this.delayAddToast()},e.prototype.ionSlideWillChange=function(){this.delayAddToastTimer&&clearTimeout(this.delayAddToastTimer)},e.prototype.ionSlideDidChange=function(){return i.__awaiter(this,void 0,void 0,function(){return i.__generator(this,function(e){return this.componentRef.instance.blue=!0,this.setCurrentSlide(),[2]})})},e.prototype.handleUpload=function(n){var t=this;this.uploadSubscription=this.uploadService.upload(n.target.files,this.adminUserService.user.id.toString()).subscribe(function(n){if(t.logger.debug(e.TAG+" handleUpload() payload: "+JSON.stringify(n)),"start"===n.status)t.uploadIndicatorData={status:n.status,data:"准备上传"};else if("upload"===n.status){var l=n.data.filter(function(e){return"upload"===e.status||"finish"===e.status});t.logger.debug(e.TAG+" handleUpload() uploadingList: "+JSON.stringify(l));var i=l.map(function(e){return e.progress}).reduce(function(e,n){return e+n},0);i=Math.ceil(i/l.length),t.logger.debug(e.TAG+" handleUpload() progress: "+i),t.uploadIndicatorData={status:n.status,data:i}}else t.uploadIndicatorData={status:"finish",data:"上传完成"},t.addPhoto(n.data)}),setTimeout(function(){n.target.value=null},100)},e.prototype.modelsFilterSlides=function(){return this.models.filter(function(e){return"slides"!==e.role})},e.prototype.getSlideModel=function(){return this.models.find(function(e){return"slides"===e.role})},e.prototype.delete=function(){return i.__awaiter(this,void 0,void 0,function(){var e;return i.__generator(this,function(n){switch(n.label){case 0:return[4,this.slidesComponent.getActiveIndex()];case 1:return e=n.sent(),this.getSlideModel().content.splice(e,1),[4,this.slidesComponent.update()];case 2:return n.sent(),this.setCurrentSlide(),[2]}})})},e.prototype.edit=function(e,n){var t=this;if(this.container=this.containers.find(function(e,t){return t===n}),this.container){e.edit=!0;var l=this.componentFactoryResolver.resolveComponentFactory(h.a);this.container.clear(),this.componentRef=this.container.createComponent(l),this.componentRef.instance.blue=this.blue,this.componentRef.instance.data=new p.a({value:e.content,required:e.required,label:1===n?"图片描述信息":e.description}),this.componentRef.instance.dataChanged.subscribe(function(n){e.content=n}),this.componentRef.instance.onBlur.subscribe(function(n){t.container.clear(),e.edit=!1})}},e.prototype.publish=function(){var e=this,n=this.preparePostData();n&&(Object.assign(n,{id:this.articleId,websiteId:this.websiteId,faddperson:this.adminUserService.user.id,columnId:this.columnId,areaid:this.publishAreaId,publishpower:"jialing"===this.app.appConfig.name?0:this.publishpower,ftypeid:2,fcontent:"",fsummary:""}),this.aumsService.addArticle(n).subscribe(function(t){var l=t.data.articleid;e.isPublished=!0,e.models.filter(function(n){"push"==n.role&&(e.pushThis=n),"title"==n.role&&(e.title=n)}),e.pushThis.content&&(e.aumsService.pushArticleTo({content:e.normalUserService.user.role,title:e.title.content,columnId:e.columnId.toString(),articleId:"",pushType:1,userType:2,areaId:e.publishAreaId,loadUrl:e.app.appConfig.notification.stb.atlas+"?aid="+l,typeId:2}).subscribe(function(e){},function(){}),e.aumsService.pushArticleTo({content:e.normalUserService.user.role,title:e.title.content,columnId:e.columnId.toString(),articleId:"",pushType:2,userType:6,areaId:e.publishAreaId,loadUrl:e.app.appConfig.notification.stb.atlas+"?aid="+l,typeId:2}).subscribe(function(e){})),e.app.appChannel.emit({type:e.articleId?g.a.PUBLISHEDIT:g.a.PUBLISHNEW,data:{title:n.ftitle,thumbnail:e.thumbnail}}),e.app.back()}))},e.prototype.onCancelUpload=function(){this.uploadSubscription&&this.uploadSubscription.unsubscribe()},e.prototype.loadArticle=function(e){var n=this;this.articleId?this.aumsService.getArticle({id:this.articleId,typeid:2}).subscribe(function(t){"success"===t.status&&(n.articleData=t.data,e())}):e()},e.prototype.fillModels=function(){var n=this;this.initSlides();var t=this.articleData&&this.articleData.article;t&&this.models.forEach(function(e){switch(e.role){case"title":e.content=t.ftitle;break;case"push":n.pushThis=e.content;break;case"public":e.content=1===t.publicly}}),this.logger.debug(e.TAG+" fillModels() models:",this.models)},e.prototype.initSlides=function(){var e=this.models.find(function(e){return"slides"===e.role});if(this.articleId){var n=this.articleData&&this.articleData.ArticleRelation;Array.isArray(n)&&(e.content=n.filter(function(e){return null!=e}).map(function(e){return{content:e.atext,added:!0,id:e.id,url:e.adescride,imageid:e.imageid}}))}e.content.push(Object.assign({},this.placeSlide)),this.setCurrentSlide()},e.prototype.delayAddToast=function(){return i.__awaiter(this,void 0,void 0,function(){var e,n,t,l=this;return i.__generator(this,function(i){switch(i.label){case 0:return[4,this.slidesComponent.getActiveIndex()];case 1:return e=i.sent(),n=this.models.find(function(e){return"slides"===e.role}),(t=n.content[e])&&!t.url&&(this.delayAddToastTimer=setTimeout(function(){l.utils.toast("fail","当前图片未添加！")},200)),[2]}})})},e.prototype.addPhoto=function(n){return i.__awaiter(this,void 0,void 0,function(){var t,l,a,r,o;return i.__generator(this,function(i){switch(i.label){case 0:return n=n&&n.filter(function(e){return"finish"===e.status}),Array.isArray(n)&&n.length?[4,this.slidesComponent.getActiveIndex()]:[2];case 1:return t=i.sent(),l=this.getSlideModel().content,a=l[t],o=n.map(function(e){return{imageid:+e.id,url:e.url,added:!0}}),a.added?r=!1:(r=!0,Object.assign(a,o.shift()),o.push(this.placeSlide)),o.length&&l.splice.apply(l,[t+1,0].concat(o)),this.logger.debug(e.TAG+" addPhoto() slides: "+JSON.stringify(l)),[4,this.slidesComponent.update()];case 2:return i.sent(),r?[3,4]:[4,this.slidesComponent.slideNext()];case 3:i.sent(),i.label=4;case 4:return[2]}})})},e.prototype.setCurrentSlide=function(){return i.__awaiter(this,void 0,void 0,function(){var e,n,t=this;return i.__generator(this,function(l){switch(l.label){case 0:return e=0,this.slidesComponent?[4,this.slidesComponent.getActiveIndex()]:[3,2];case 1:e=l.sent(),l.label=2;case 2:return n=this.getSlideModel().content,this.currentSlide=n[e],this.slidesComponent&&setTimeout(function(){t.slidesComponent.slideTo(e)},200),[2]}})})},e.prototype.preparePostData=function(){var e,n,t=this,l={};return this.models.every(function(i){return"title"===i.role&&(l.ftitle=i.content),"public"===i.role&&(l.publicly=i.content?1:0),"slides"===i.role&&(n=i.content.filter(function(e){return!0===e.added}).map(function(e){return{type:"img",imgid:e.imageid,description:e.url,domid:"图集图片",atext:e.content||"",aenabeled:1,id:""}})).length&&(l.fimage=n[0].imgid,t.thumbnail=n[0].description),!("title"===i.role&&!i.content&&(e=i.description+"不能为空",1))}),e?(this.utils.toast("fail",e),null):(l.temArray=n&&n.length?JSON.stringify(n):null,l)},e.prototype.gotoAreaTree=function(){this.gotoArea=!0,this.areaTreeService.businessType=m.a.ARTICLE_PUBLISH_AREA,this.areaTreeService.reset(),this.router.navigate(["standard/area-tree",{page:e.TAG}])},e.prototype.isSaveAlert=function(){return i.__awaiter(this,void 0,void 0,function(){var e=this;return i.__generator(this,function(n){return[2,new Promise(function(n,t){return i.__awaiter(e,void 0,void 0,function(){return i.__generator(this,function(e){switch(e.label){case 0:return[4,this.alertCtrl.create({header:"退出编辑",message:"您有修改的内容未保存，是否确定退出？",buttons:[{text:"取消",role:"cancel",handler:function(e){n(!1),console.log("点击了取消按钮",e)}},{text:"确定",role:"confirm",handler:function(){n(!0),console.log("点击了确定按钮")}}]})];case 1:return[4,e.sent().present()];case 2:return e.sent(),[2]}})})})]})})},e.TAG="PublishPhotosComponent",e}(),v=t("4/GC"),A=function(){return function(){}}(),C=t("pMnS"),y=t("MKJQ"),S=t("jy/b"),_=t("Ip0R"),R=t("gIcY"),I=function(){function e(){this.cancel=new l.EventEmitter}return e.prototype.ngOnInit=function(){},e.prototype.onClose=function(){this.data.status="finish",this.cancel.emit()},e}(),T=l["ɵcrt"]({encapsulation:0,styles:[[".box[_ngcontent-%COMP%]{background:#fafafa;display:flex;flex-direction:column;align-items:center;justify-content:center;padding-top:24px;min-width:250px;max-width:280px;max-height:90%;border-radius:2px;box-shadow:0 16px 20px rgba(0,0,0,.4);color:rgba(0,0,0,.5)}.box[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:0 24px 8px}.box[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{width:100%;text-align:right;padding:0 8px 8px 24px}"]],data:{}});function O(e){return l["ɵvid"](0,[(e()(),l["ɵeld"](0,0,null,null,9,"div",[["class","box"]],null,null,null,null,null)),(e()(),l["ɵeld"](1,0,null,null,2,"div",[["class","item"]],null,null,null,null,null)),(e()(),l["ɵeld"](2,0,null,null,1,"ion-spinner",[["color","primary"]],null,null,null,y.Wb,y.V)),l["ɵdid"](3,49152,null,0,S.qb,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{color:[0,"color"]},null),(e()(),l["ɵeld"](4,0,null,null,1,"div",[["class","item"]],null,null,null,null,null)),(e()(),l["ɵted"](5,null,["上传中...(","%)"])),(e()(),l["ɵeld"](6,0,null,null,3,"div",[["class","actions"]],null,null,null,null,null)),(e()(),l["ɵeld"](7,0,null,null,2,"ion-button",[["fill","clear"]],null,[[null,"click"]],function(e,n,t){var l=!0;return"click"===n&&(l=!1!==e.component.onClose()&&l),l},y.fb,y.e)),l["ɵdid"](8,49152,null,0,S.l,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{fill:[0,"fill"]},null),(e()(),l["ɵted"](-1,0,["取消"]))],function(e,n){e(n,3,0,"primary"),e(n,8,0,"clear")},function(e,n){e(n,5,0,n.component.data.data)})}var E=t("ZYCi"),P=l["ɵcrt"]({encapsulation:0,styles:[["ion-content[_ngcontent-%COMP%]{--background:#000000}.list[_ngcontent-%COMP%]{position:absolute;left:0;top:0;z-index:10;width:100%;padding-bottom:12px;color:#fff;background:linear-gradient(to bottom,rgba(107,158,84,.5),rgba(107,158,84,.5))}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{padding:12px 16px 0}.list[_ngcontent-%COMP%]   .item.line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px}.list[_ngcontent-%COMP%]   .item.line[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:0}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{display:flex;position:relative;overflow:hidden;padding-bottom:5px;border-bottom:1px solid #b6b6b6}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .field-content[_ngcontent-%COMP%]{flex:1;padding-right:10px;white-space:normal}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-toggle[_ngcontent-%COMP%]{padding:5px 0}.actions[_ngcontent-%COMP%]{position:absolute;right:16px;bottom:16px;z-index:10;display:flex;flex-direction:column}.actions[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;align-items:center;color:#fff}.actions[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{padding-left:8px}.actions[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:36px;background-color:rgba(255,255,255,.4);font-size:18px;--padding-start:0;--padding-end:0}.actions[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#fff}.actions[_ngcontent-%COMP%]   .upload-image-box[_ngcontent-%COMP%]{position:relative}.actions[_ngcontent-%COMP%]   .upload-image-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;opacity:0;z-index:10}ion-slides[_ngcontent-%COMP%]{height:100%}app-upload-indicator[_ngcontent-%COMP%]{position:absolute;left:0;top:0;right:0;bottom:0;z-index:100;display:flex;justify-content:center;align-items:center}ion-item[_ngcontent-%COMP%]{--background:transparent;--color:white;padding:unset!important;--border-color:#b6b6b6;--padding-start:0;--inner-padding-end:2px}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{line-height:3rem;font-size:14px;padding-right:5px}"]],data:{}});function x(e){return l["ɵvid"](0,[(e()(),l["ɵeld"](0,0,null,null,8,null,null,null,null,null,null,null)),(e()(),l["ɵeld"](1,0,null,null,7,"ion-item",[["button",""],["detail",""]],null,[[null,"click"]],function(e,n,t){var l=!0;return"click"===n&&(l=!1!==e.component.gotoAreaTree()&&l),l},y.Db,y.z)),l["ɵdid"](2,49152,null,0,S.I,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{button:[0,"button"],detail:[1,"detail"]},null),(e()(),l["ɵeld"](3,0,null,0,2,"ion-label",[],null,null,null,y.Eb,y.D)),l["ɵdid"](4,49152,null,0,S.O,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(e()(),l["ɵted"](5,0,[" "," "])),(e()(),l["ɵeld"](6,0,null,0,2,"ion-note",[["color","light"]],null,null,null,y.Hb,y.G)),l["ɵdid"](7,49152,null,0,S.W,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{color:[0,"color"]},null),(e()(),l["ɵted"](8,0,[" "," "]))],function(e,n){e(n,2,0,"",""),e(n,7,0,"light")},function(e,n){var t=n.component;e(n,5,0,n.parent.parent.context.$implicit.description+":"),e(n,8,0,t.publishAreaName)})}function w(e){return l["ɵvid"](0,[(e()(),l["ɵeld"](0,0,null,null,3,"div",[["class","field"]],null,[[null,"click"]],function(e,n,t){var l=!0;return"click"===n&&(l=!1!==e.component.edit(e.parent.parent.parent.context.$implicit,0)&&l),l},null,null)),(e()(),l["ɵeld"](1,0,null,null,0,"div",[["class","field-content"]],[[8,"innerHTML",1]],null,null,null,null)),(e()(),l["ɵeld"](2,0,null,null,1,"ion-icon",[["src","assets/icons/edit.svg"]],null,null,null,y.vb,y.u)),l["ɵdid"](3,49152,null,0,S.D,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{src:[0,"src"]},null)],function(e,n){e(n,3,0,"assets/icons/edit.svg")},function(e,n){e(n,1,0,n.parent.parent.parent.context.$implicit.content||"添加"+n.parent.parent.parent.context.$implicit.description)})}function M(e){return l["ɵvid"](0,[(e()(),l["ɵand"](0,null,null,0))],null,null)}function L(e){return l["ɵvid"](0,[(e()(),l["ɵeld"](0,0,null,null,3,null,null,null,null,null,null,null)),(e()(),l["ɵand"](16777216,null,null,1,null,w)),l["ɵdid"](2,16384,null,0,_.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["ɵand"](16777216,[[1,3],["container",2]],null,0,null,M)),(e()(),l["ɵand"](0,null,null,0))],function(e,n){e(n,2,0,!n.parent.parent.context.$implicit.edit)},null)}function N(e){return l["ɵvid"](0,[(e()(),l["ɵeld"](0,0,null,null,6,null,null,null,null,null,null,null)),(e()(),l["ɵeld"](1,0,null,null,5,null,null,null,null,null,null,null)),l["ɵdid"](2,16384,null,0,_.NgSwitch,[],{ngSwitch:[0,"ngSwitch"]},null),(e()(),l["ɵand"](16777216,null,null,1,null,x)),l["ɵdid"](4,278528,null,0,_.NgSwitchCase,[l.ViewContainerRef,l.TemplateRef,_.NgSwitch],{ngSwitchCase:[0,"ngSwitchCase"]},null),(e()(),l["ɵand"](16777216,null,null,1,null,L)),l["ɵdid"](6,16384,null,0,_.NgSwitchDefault,[l.ViewContainerRef,l.TemplateRef,_.NgSwitch],null,null),(e()(),l["ɵand"](0,null,null,0))],function(e,n){e(n,2,0,n.parent.context.$implicit.role),e(n,4,0,"publishArea")},null)}function D(e){return l["ɵvid"](0,[(e()(),l["ɵeld"](0,0,null,null,9,null,null,null,null,null,null,null)),(e()(),l["ɵeld"](1,0,null,null,1,"label",[],null,null,null,null,null)),(e()(),l["ɵted"](2,null,["",""])),(e()(),l["ɵeld"](3,0,null,null,6,"ion-toggle",[["color","secondary"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"ionBlur"],[null,"ionChange"]],function(e,n,t){var i=!0;return"ionBlur"===n&&(i=!1!==l["ɵnov"](e,5)._handleBlurEvent(t.target)&&i),"ionChange"===n&&(i=!1!==l["ɵnov"](e,5)._handleIonChange(t.target)&&i),"ngModelChange"===n&&(i=!1!==(e.parent.context.$implicit.content=t)&&i),i},y.ac,y.Z)),l["ɵdid"](4,49152,null,0,S.zb,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{color:[0,"color"]},null),l["ɵdid"](5,16384,null,0,S.d,[l.ElementRef],null,null),l["ɵprd"](1024,null,R.m,function(e){return[e]},[S.d]),l["ɵdid"](7,671744,null,0,R.r,[[8,null],[8,null],[8,null],[6,R.m]],{model:[0,"model"]},{update:"ngModelChange"}),l["ɵprd"](2048,null,R.n,null,[R.r]),l["ɵdid"](9,16384,null,0,R.o,[[4,R.n]],null,null)],function(e,n){e(n,4,0,"secondary"),e(n,7,0,n.parent.context.$implicit.content)},function(e,n){e(n,2,0,n.parent.context.$implicit.description+":"),e(n,3,0,l["ɵnov"](n,9).ngClassUntouched,l["ɵnov"](n,9).ngClassTouched,l["ɵnov"](n,9).ngClassPristine,l["ɵnov"](n,9).ngClassDirty,l["ɵnov"](n,9).ngClassValid,l["ɵnov"](n,9).ngClassInvalid,l["ɵnov"](n,9).ngClassPending)})}function j(e){return l["ɵvid"](0,[(e()(),l["ɵeld"](0,0,null,null,6,"div",[["class","item"]],[[2,"line",null]],null,null,null,null)),(e()(),l["ɵeld"](1,0,null,null,5,null,null,null,null,null,null,null)),l["ɵdid"](2,16384,null,0,_.NgSwitch,[],{ngSwitch:[0,"ngSwitch"]},null),(e()(),l["ɵand"](16777216,null,null,1,null,N)),l["ɵdid"](4,278528,null,0,_.NgSwitchCase,[l.ViewContainerRef,l.TemplateRef,_.NgSwitch],{ngSwitchCase:[0,"ngSwitchCase"]},null),(e()(),l["ɵand"](16777216,null,null,1,null,D)),l["ɵdid"](6,278528,null,0,_.NgSwitchCase,[l.ViewContainerRef,l.TemplateRef,_.NgSwitch],{ngSwitchCase:[0,"ngSwitchCase"]},null)],function(e,n){e(n,2,0,n.context.$implicit.type),e(n,4,0,"text"),e(n,6,0,"toggle")},function(e,n){e(n,0,0,"toggle"===n.context.$implicit.type)})}function U(e){return l["ɵvid"](0,[(e()(),l["ɵand"](0,null,null,0))],null,null)}function k(e){return l["ɵvid"](0,[(e()(),l["ɵeld"](0,0,null,null,6,"div",[["class","item"]],null,null,null,null,null)),(e()(),l["ɵeld"](1,0,null,null,3,"ion-button",[["color","dark"],["fill","clear"],["shape","round"],["size","small"]],null,[[null,"click"]],function(e,n,t){var l=!0;return"click"===n&&(l=!1!==e.component.delete()&&l),l},y.fb,y.e)),l["ɵdid"](2,49152,null,0,S.l,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{color:[0,"color"],fill:[1,"fill"],shape:[2,"shape"],size:[3,"size"]},null),(e()(),l["ɵeld"](3,0,null,0,1,"ion-icon",[["src","assets/icons/trash-outline.svg"]],null,null,null,y.vb,y.u)),l["ɵdid"](4,49152,null,0,S.D,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{src:[0,"src"]},null),(e()(),l["ɵeld"](5,0,null,null,1,"div",[["class","label"]],null,null,null,null,null)),(e()(),l["ɵted"](-1,null,["删除"]))],function(e,n){e(n,2,0,"dark","clear","round","small"),e(n,4,0,"assets/icons/trash-outline.svg")},null)}function B(e){return l["ɵvid"](0,[(e()(),l["ɵeld"](0,0,null,null,2,"ion-slide",[],null,null,null,y.Ub,y.T)),l["ɵdid"](1,49152,null,0,S.ob,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(e()(),l["ɵeld"](2,0,null,0,0,"img",[],[[8,"src",4]],null,null,null,null))],null,function(e,n){e(n,2,0,n.context.$implicit.url||n.component.placePhoto)})}function H(e){return l["ɵvid"](0,[(e()(),l["ɵeld"](0,0,null,null,1,"app-upload-indicator",[],null,[[null,"cancel"]],function(e,n,t){var l=!0;return"cancel"===n&&(l=!1!==e.component.onCancelUpload()&&l),l},O,T)),l["ɵdid"](1,114688,null,0,I,[],{data:[0,"data"]},{cancel:"cancel"})],function(e,n){e(n,1,0,n.component.uploadIndicatorData)},null)}function V(e){return l["ɵvid"](0,[l["ɵqud"](671088640,1,{containers:1}),l["ɵqud"](671088640,2,{slidesComponent:0}),(e()(),l["ɵeld"](2,0,null,null,15,"ion-header",[["class","ion-no-border"]],null,null,null,y.ub,y.t)),l["ɵdid"](3,49152,null,0,S.C,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(e()(),l["ɵeld"](4,0,null,0,13,"ion-toolbar",[["mode","ios"]],null,null,null,y.bc,y.ab)),l["ɵdid"](5,49152,null,0,S.Ab,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{mode:[0,"mode"]},null),(e()(),l["ɵeld"](6,0,null,0,3,"ion-buttons",[["slot","start"]],null,null,null,y.gb,y.f)),l["ɵdid"](7,49152,null,0,S.m,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(e()(),l["ɵeld"](8,0,null,0,1,"ion-icon",[["name","chevron-back-outline"]],null,[[null,"click"]],function(e,n,t){var l=!0;return"click"===n&&(l=!1!==e.component.app.back()&&l),l},y.vb,y.u)),l["ɵdid"](9,49152,null,0,S.D,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{name:[0,"name"]},null),(e()(),l["ɵeld"](10,0,null,0,2,"ion-title",[],null,null,null,y.Zb,y.Y)),l["ɵdid"](11,49152,null,0,S.yb,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(e()(),l["ɵted"](12,0,["",""])),(e()(),l["ɵeld"](13,0,null,0,4,"ion-buttons",[["slot","end"]],null,null,null,y.gb,y.f)),l["ɵdid"](14,49152,null,0,S.m,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(e()(),l["ɵeld"](15,0,null,0,2,"ion-button",[["fill","clear"]],null,[[null,"click"]],function(e,n,t){var l=!0;return"click"===n&&(l=!1!==e.component.publish()&&l),l},y.fb,y.e)),l["ɵdid"](16,49152,null,0,S.l,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{fill:[0,"fill"]},null),(e()(),l["ɵted"](-1,0,["发布"])),(e()(),l["ɵeld"](18,0,null,null,28,"ion-content",[],null,null,null,y.ob,y.n)),l["ɵdid"](19,49152,null,0,S.v,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(e()(),l["ɵeld"](20,0,null,0,8,"div",[["class","list"]],null,null,null,null,null)),(e()(),l["ɵand"](16777216,null,null,1,null,j)),l["ɵdid"](22,278528,null,0,_.NgForOf,[l.ViewContainerRef,l.TemplateRef,l.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),l["ɵeld"](23,0,null,null,5,"div",[["class","item"]],null,null,null,null,null)),(e()(),l["ɵeld"](24,0,null,null,3,"div",[["class","field"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;return"click"===n&&(l=!1!==i.edit(i.currentSlide,1)&&l),l},null,null)),(e()(),l["ɵeld"](25,0,null,null,0,"div",[["class","field-content"]],[[8,"innerHTML",1]],null,null,null,null)),(e()(),l["ɵeld"](26,0,null,null,1,"ion-icon",[["src","assets/icons/edit.svg"]],null,null,null,y.vb,y.u)),l["ɵdid"](27,49152,null,0,S.D,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{src:[0,"src"]},null),(e()(),l["ɵand"](16777216,[[1,3],["container",2]],null,0,null,U)),(e()(),l["ɵeld"](29,0,null,0,11,"div",[["class","actions"]],null,null,null,null,null)),(e()(),l["ɵeld"](30,0,null,null,8,"div",[["class","item"]],null,null,null,null,null)),(e()(),l["ɵeld"](31,0,null,null,5,"div",[["class","upload-image-box"]],null,null,null,null,null)),(e()(),l["ɵeld"](32,0,null,null,0,"input",[["accept","image/*"],["multiple",""],["type","file"]],null,[[null,"change"]],function(e,n,t){var l=!0;return"change"===n&&(l=!1!==e.component.handleUpload(t)&&l),l},null,null)),(e()(),l["ɵeld"](33,0,null,null,3,"ion-button",[["color","dark"],["fill","clear"],["shape","round"],["size","small"]],null,null,null,y.fb,y.e)),l["ɵdid"](34,49152,null,0,S.l,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{color:[0,"color"],fill:[1,"fill"],shape:[2,"shape"],size:[3,"size"]},null),(e()(),l["ɵeld"](35,0,null,0,1,"ion-icon",[["src","assets/icons/photo.svg"]],null,null,null,y.vb,y.u)),l["ɵdid"](36,49152,null,0,S.D,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{src:[0,"src"]},null),(e()(),l["ɵeld"](37,0,null,null,1,"div",[["class","label"]],null,null,null,null,null)),(e()(),l["ɵted"](-1,null,["添加图片"])),(e()(),l["ɵand"](16777216,null,null,1,null,k)),l["ɵdid"](40,16384,null,0,_.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["ɵeld"](41,0,null,0,3,"ion-slides",[],null,[[null,"ionSlideTouchStart"],[null,"ionSlideWillChange"],[null,"ionSlideDidChange"]],function(e,n,t){var l=!0,i=e.component;return"ionSlideTouchStart"===n&&(l=!1!==i.ionSlideTransitionStart(t)&&l),"ionSlideWillChange"===n&&(l=!1!==i.ionSlideWillChange()&&l),"ionSlideDidChange"===n&&(l=!1!==i.ionSlideDidChange()&&l),l},y.Vb,y.U)),l["ɵdid"](42,49152,[[2,4]],0,S.pb,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(e()(),l["ɵand"](16777216,null,0,1,null,B)),l["ɵdid"](44,278528,null,0,_.NgForOf,[l.ViewContainerRef,l.TemplateRef,l.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),l["ɵand"](16777216,null,0,1,null,H)),l["ɵdid"](46,16384,null,0,_.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null)],function(e,n){var t=n.component;e(n,5,0,"ios"),e(n,9,0,"chevron-back-outline"),e(n,16,0,"clear"),e(n,22,0,t.modelsFilterSlides()),e(n,27,0,"assets/icons/edit.svg"),e(n,34,0,"dark","clear","round","small"),e(n,36,0,"assets/icons/photo.svg"),e(n,40,0,t.canDelete),e(n,44,0,t.getSlideModel().content),e(n,46,0,"start"===(null==t.uploadIndicatorData?null:t.uploadIndicatorData.status)||"upload"===(null==t.uploadIndicatorData?null:t.uploadIndicatorData.status))},function(e,n){var t=n.component;e(n,12,0,t.columnName),e(n,25,0,(null==t.currentSlide?null:t.currentSlide.content)||"添加图片描述信息")})}function F(e){return l["ɵvid"](0,[(e()(),l["ɵeld"](0,0,null,null,1,"app-publish-photos",[],null,null,null,V,P)),l["ɵdid"](1,245760,null,0,b,[a.a,E.a,r.a,o.a,c,d.a,s.b,l.ComponentFactoryResolver,S.b,f.a,m.b,E.m],null,null)],function(e,n){e(n,1,0)},null)}var Z=l["ɵccf"]("app-publish-photos",b,F,{},{},[]),z=function(){return function(){}}();t.d(n,"PublishPhotosModuleNgFactory",function(){return G});var G=l["ɵcmf"](A,[],function(e){return l["ɵmod"]([l["ɵmpd"](512,l.ComponentFactoryResolver,l["ɵCodegenComponentFactoryResolver"],[[8,[C.a,Z]],[3,l.ComponentFactoryResolver],l.NgModuleRef]),l["ɵmpd"](4608,_.NgLocalization,_.NgLocaleLocalization,[l.LOCALE_ID,[2,_["ɵangular_packages_common_common_a"]]]),l["ɵmpd"](4608,S.c,S.c,[l.NgZone,l.ApplicationRef]),l["ɵmpd"](4608,S.Fb,S.Fb,[S.c,l.ComponentFactoryResolver,l.Injector]),l["ɵmpd"](4608,S.Jb,S.Jb,[S.c,l.ComponentFactoryResolver,l.Injector]),l["ɵmpd"](4608,R.y,R.y,[]),l["ɵmpd"](1073742336,_.CommonModule,_.CommonModule,[]),l["ɵmpd"](1073742336,E.n,E.n,[[2,E.s],[2,E.m]]),l["ɵmpd"](1073742336,S.Cb,S.Cb,[]),l["ɵmpd"](1073742336,R.x,R.x,[]),l["ɵmpd"](1073742336,R.i,R.i,[]),l["ɵmpd"](1073742336,z,z,[]),l["ɵmpd"](1073742336,A,A,[]),l["ɵmpd"](1024,E.k,function(){return[[{path:"",component:b,canDeactivate:[v.a]}]]},[])])})},TN67:function(e,n,t){"use strict";t.d(n,"a",function(){return c}),t.d(n,"b",function(){return d});var l=t("lbwW"),i=t("F/XL"),a=t("15JJ"),r=t("67Y/"),o=t("O0u2"),u=t("atIC"),s=t("CcnG"),c=function(e){return e[e.SELECT_PUBLIC_AREA=0]="SELECT_PUBLIC_AREA",e[e.SHORT_VIDEO_SHARE=1]="SHORT_VIDEO_SHARE",e[e.SHORT_VIDEO_SHARE_STB=2]="SHORT_VIDEO_SHARE_STB",e[e.LIVE_SHARE=3]="LIVE_SHARE",e[e.LIVE_SHARE_STB=4]="LIVE_SHARE_STB",e[e.ARTICLE_PUBLISH_AREA=5]="ARTICLE_PUBLISH_AREA",e[e.SELECT_BELONGS_AREA=6]="SELECT_BELONGS_AREA",e[e.ARTICLE_SHARE=7]="ARTICLE_SHARE",e}({}),d=function(){function e(e,n,t){this.aums=e,this.adminUserService=n,this.app=t,this.userSelectAllArea="",this.userSelectTown="",this.formatAreaTree=[]}return Object.defineProperty(e.prototype,"selectedAreaList",{get:function(){return this._selectedAreaList},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.shareShortVideoAreaTree=null,this.shareLiveAreaTree=null,this.articlePublishAreaTree=null,this.pageCount=1},e.prototype.addSelectedAreaList=function(e,n){void 0===n&&(n=!1),this._selectedAreaList&&!n||(this._selectedAreaList=[]),this._selectedAreaList.push(e)},e.prototype.getList=function(e){var n=this,t=e.areaId,l=e.upLevel;return Object(i.a)(this.businessType).pipe(Object(a.a)(function(e){switch(e){case c.SELECT_PUBLIC_AREA:case c.SELECT_BELONGS_AREA:return n.aums.getAreaList({areaId:t}).pipe(Object(r.a)(function(e){var n=e.data&&e.data.children;return Array.isArray(n)&&n.length?{status:"success",data:n}:Array.isArray(n)?{status:"empty"}:e}));case c.SHORT_VIDEO_SHARE:case c.SHORT_VIDEO_SHARE_STB:return n.getShareShortVideoAreaTree(t);case c.LIVE_SHARE:case c.LIVE_SHARE_STB:return n.getShareLiveAreaTree(l,t);case c.ARTICLE_PUBLISH_AREA:return n.getArticlePublishAreaTree(t);case c.ARTICLE_SHARE:return n.getShareArticleAreaTree(l,t)}}))},e.prototype.getShareShortVideoAreaTree=function(e){var n=this;if(e){var t=this.getChildrenAreaTreeByAreaId(this.shareShortVideoAreaTree,e);return Array.isArray(t)&&t.length?Object(i.a)({status:"success",data:t}):Object(i.a)({status:"error",message:"当前分享区域为空"})}return Object(i.a)(this.adminUserService.user).pipe(Object(a.a)(function(e){return e?n.aums.getShareShortVideoAreaTree({userId:e.id.toString(),userType:n.app.appConfig.aums.userType}).pipe(Object(r.a)(function(e){return"success"===e.status?(n.shareShortVideoAreaTree=n.convertToAreaList(e.data),{status:"success",data:n.shareShortVideoAreaTree}):e})):Object(i.a)({status:"error",message:"管理用户未登录！"})}))},e.prototype.getShareLiveAreaTree=function(e,n){var t=this;if(n){var l=this.getChildrenAreaTreeByAreaId(this.shareLiveAreaTree,n);return Array.isArray(l)&&l.length?Object(i.a)({status:"success",data:l}):Object(i.a)({status:"error",message:"当前分享区域为空"})}return Object(i.a)(this.adminUserService.user).pipe(Object(a.a)(function(n){return n?t.aums.getAreaListByAreaId({regionId:n.areaId,upperLevel:e,lowerLevel:7,needDetailInfo:!0}).pipe(Object(r.a)(function(e){return"success"===e.status?(t.shareLiveAreaTree=t.convertToAreaList(e.data),{status:"success",data:t.shareLiveAreaTree}):e})):Object(i.a)({status:"error",message:"管理用户未登录！"})}))},e.prototype.getShareArticleAreaTree=function(e,n){var t=this;if(n){var l=this.getChildrenAreaTreeByAreaId(this.shareArticleAreaTree,n);return Array.isArray(l)&&l.length?Object(i.a)({status:"success",data:l}):Object(i.a)({status:"error",message:"当前分享区域为空"})}return Object(i.a)(this.adminUserService.user).pipe(Object(a.a)(function(n){return n?t.aums.getAreaListByAreaId({regionId:n.areaId,upperLevel:e,lowerLevel:7,needDetailInfo:!0}).pipe(Object(r.a)(function(e){return"success"===e.status?(t.shareArticleAreaTree=t.convertToAreaList(e.data),{status:"success",data:t.shareArticleAreaTree}):e})):Object(i.a)({status:"error",message:"管理用户未登录！"})}))},e.prototype.getArticlePublishAreaTree=function(e){var n=this;if(e){var t=this.getChildrenAreaTreeByAreaId(this.articlePublishAreaTree,e);return Array.isArray(t)&&t.length?Object(i.a)({status:"success",data:t}):Object(i.a)({status:"error",message:"可发布区域为空"})}return Object(i.a)(this.adminUserService.user).pipe(Object(a.a)(function(e){return e?n.aums.articlePublishAreaTree({areaId:e.areaId}).pipe(Object(r.a)(function(e){return"success"===e.status?(n.articlePublishAreaTree=n.convertToAreaList(e.data[0]),{status:"success",data:n.articlePublishAreaTree}):e})):Object(i.a)({status:"error",message:"管理用户未登录！"})}))},e.prototype.convertToAreaList=function(e){var n,t;if(Array.isArray(e.upperRegion)&&e.upperRegion.length)for(var l=0;l<e.upperRegion.length;l++)0==l?n=[e.upperRegion[l]]:t&&(t.children=[e.upperRegion[l]]),t=e.upperRegion[l];return e.areaId&&e.areaName&&e.areaLevel&&(t?t.children=[{areaName:e.areaName,areaId:e.areaId,areaLevel:e.areaLevel,children:e.lowerRegion||[]}]:n=[{areaName:e.areaName,areaId:e.areaId,areaLevel:e.areaLevel,children:e.lowerRegion||[]}]),e.id&&e.text&&e.level&&(this.formatAreaTree=[],n=[{areaName:e.text,areaId:e.id,areaLevel:e.level,children:this.formatAreaList(e)}]),n},e.prototype.getChildrenAreaTreeByAreaId=function(e,n){var t;if(e)for(var l=0;l<e.length;l++)if(t=e[l].areaId===n?e[l].children:this.getChildrenAreaTreeByAreaId(e[l].children,n))return t;return t},e.prototype.formatAreaList=function(e,n){var t=this;return void 0===n&&(n=this.formatAreaTree),Array.isArray(e.children)&&e.children.length&&e.children.forEach(function(e,l){n.push({areaId:e.id,areaName:e.text,areaLevel:e.level,children:[]}),t.formatAreaList(e,n[l].children)}),this.formatAreaTree},e.ngInjectableDef=s["ɵɵdefineInjectable"]({factory:function(){return new e(s["ɵɵinject"](l.a),s["ɵɵinject"](o.a),s["ɵɵinject"](u.a))},token:e,providedIn:"root"}),e}()}}]);