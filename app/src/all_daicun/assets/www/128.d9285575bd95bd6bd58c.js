(window.webpackJsonp=window.webpackJsonp||[]).push([[128],{"+ACA":function(e,n,t){"use strict";t.r(n);var r=t("CcnG"),a=t("atIC"),l=t("TN67"),i=t("1FC6"),u=t("lbwW"),s=t("B0rH"),o=t("h1wG"),c=function(){function e(e,n,t,r,a,l,i){this.app=e,this.areaTreeService=n,this.router=t,this.logger=r,this.aums=a,this.utils=l,this.normalUserService=i}return e.prototype.ngOnInit=function(){var n=this;this.appChannelSubscription=this.app.appChannel.subscribe(function(t){if(t.type===i.a.SELECTAREA){if(n.areaTreeService.businessType!==l.a.SELECT_BELONGS_AREA)return;n.logger.info(e.TAG+" app channel select area: "+JSON.stringify(t)),n.currentItem?n.updateGuest(t):n.saveGuest(t)}}),this.logger.debug(e.TAG+" ngOnInit() 区域绑定页面已初始化"),this.logger.debug(e.TAG+" ngOnInit() 用户是否绑定区域:"+JSON.stringify(this.normalUserService.belongsAreaList))},e.prototype.ngOnDestroy=function(){this.appChannelSubscription.unsubscribe()},e.prototype.bind=function(e){this.areaTreeService.businessType=l.a.SELECT_BELONGS_AREA,this.areaTreeService.pageCount=1,this.currentItem=e,this.router.navigate(["/standard/area-tree",{areaId:this.app.appConfig.aums.rootAreaId,level:this.app.appConfig.aums.rootAreaLevel}])},e.prototype.updateGuest=function(n){var t=this;this.aums.updateGuest({guestId:this.currentItem.id,areaId:n.data.areaId}).subscribe(function(r){t.logger.info(e.TAG+" updateGuest() payload: "+JSON.stringify(r)),"success"===r.status?(t.normalUserService.updateBelongsAreaListById(t.currentItem.id,r.data),t.utils.toast("success","重新认证归属地成功"),"belongs"===t.normalUserService.mode&&t.normalUserService.selectedBelongsArea.areaId===n.data.areaId&&t.app.appChannel.emit({type:i.a.RELOAD})):t.utils.toast("fail",""+(r.message||"重新认证归属地失败，请稍后再试！"))})},e.prototype.saveGuest=function(n){var t=this;this.aums.saveGuest({userId:this.normalUserService.user.userId,userName:this.normalUserService.user.userName,areaId:n.data.areaId,userType:this.app.appConfig.ums.userType}).subscribe(function(n){t.logger.info(e.TAG+" updateGuest() payload: "+JSON.stringify(n)),"success"===n.status?(t.normalUserService.updateBelongsAreaListById(null,n.data),t.utils.toast("success","绑定归属地成功")):t.utils.toast("fail",""+(n.message||"绑定归属地失败，请稍后再试！"))})},e.TAG="BindBelongsAreaComponent",e}(),d=function(){return function(){}}(),p=t("pMnS"),f=t("MKJQ"),h=t("jy/b"),A=t("Ip0R"),g=[{name:"审核不通过",value:0},{name:"审核通过",value:1},{name:"审核中",value:2}],m=function(){function e(){}return e.prototype.transform=function(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];var r=g.find(function(n){return null!=e&&n.value==e});return r?r.name:""},e}(),b=t("ZYCi"),v=t("U3FM"),R=r["ɵcrt"]({encapsulation:0,styles:[[".actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"]],data:{}});function E(e){return r["ɵvid"](0,[(e()(),r["ɵeld"](0,0,null,null,16,"ion-card",[],null,null,null,f.lb,f.g)),r["ɵdid"](1,49152,null,0,h.n,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],null,null),(e()(),r["ɵeld"](2,0,null,0,8,"ion-card-header",[],null,null,null,f.ib,f.i)),r["ɵdid"](3,49152,null,0,h.p,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],null,null),(e()(),r["ɵeld"](4,0,null,0,2,"ion-card-title",[],null,null,null,f.kb,f.k)),r["ɵdid"](5,49152,null,0,h.r,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],null,null),(e()(),r["ɵted"](6,0,["",""])),(e()(),r["ɵeld"](7,0,null,0,3,"ion-card-subtitle",[],null,null,null,f.jb,f.j)),r["ɵdid"](8,49152,null,0,h.q,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],null,null),(e()(),r["ɵted"](9,0,["",""])),r["ɵppd"](10,1),(e()(),r["ɵeld"](11,0,null,0,5,"ion-card-content",[],null,null,null,f.hb,f.h)),r["ɵdid"](12,49152,null,0,h.o,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],null,null),(e()(),r["ɵeld"](13,0,null,0,3,"div",[["class","actions"]],null,null,null,null,null)),(e()(),r["ɵeld"](14,0,null,null,2,"ion-button",[["fill","clear"]],null,[[null,"click"]],function(e,n,t){var r=!0;return"click"===n&&(r=!1!==e.component.bind(e.context.$implicit)&&r),r},f.fb,f.e)),r["ɵdid"](15,49152,null,0,h.l,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],{fill:[0,"fill"]},null),(e()(),r["ɵted"](-1,0,["重新认证"]))],function(e,n){e(n,15,0,"clear")},function(e,n){e(n,6,0,n.context.$implicit.areaName);var t=r["ɵunv"](n,9,0,e(n,10,0,r["ɵnov"](n.parent.parent,0),n.context.$implicit.checkFlag));e(n,9,0,t)})}function S(e){return r["ɵvid"](0,[(e()(),r["ɵeld"](0,0,null,null,2,null,null,null,null,null,null,null)),(e()(),r["ɵand"](16777216,null,null,1,null,E)),r["ɵdid"](2,278528,null,0,A.NgForOf,[r.ViewContainerRef,r.TemplateRef,r.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),r["ɵand"](0,null,null,0))],function(e,n){e(n,2,0,n.component.normalUserService.belongsAreaList)},null)}function T(e){return r["ɵvid"](0,[(e()(),r["ɵeld"](0,0,null,null,8,"ion-card",[],null,null,null,f.lb,f.g)),r["ɵdid"](1,49152,null,0,h.n,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],null,null),(e()(),r["ɵeld"](2,0,null,0,6,"ion-card-content",[],null,null,null,f.hb,f.h)),r["ɵdid"](3,49152,null,0,h.o,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],null,null),(e()(),r["ɵeld"](4,0,null,0,4,"ion-button",[["expand","full"],["fill","clear"]],null,[[null,"click"]],function(e,n,t){var r=!0;return"click"===n&&(r=!1!==e.component.bind()&&r),r},f.fb,f.e)),r["ɵdid"](5,49152,null,0,h.l,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],{expand:[0,"expand"],fill:[1,"fill"]},null),(e()(),r["ɵeld"](6,0,null,0,1,"ion-icon",[["name","add"]],null,null,null,f.vb,f.u)),r["ɵdid"](7,49152,null,0,h.D,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],{name:[0,"name"]},null),(e()(),r["ɵted"](-1,0,[" 绑定归属地 "]))],function(e,n){e(n,5,0,"full","clear"),e(n,7,0,"add")},null)}function I(e){return r["ɵvid"](0,[r["ɵpid"](0,m,[]),(e()(),r["ɵeld"](1,0,null,null,10,"ion-header",[],null,null,null,f.ub,f.t)),r["ɵdid"](2,49152,null,0,h.C,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],null,null),(e()(),r["ɵeld"](3,0,null,0,8,"ion-toolbar",[["mode","ios"]],null,null,null,f.bc,f.ab)),r["ɵdid"](4,49152,null,0,h.Ab,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],{mode:[0,"mode"]},null),(e()(),r["ɵeld"](5,0,null,0,3,"ion-buttons",[["slot","start"]],null,null,null,f.gb,f.f)),r["ɵdid"](6,49152,null,0,h.m,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],null,null),(e()(),r["ɵeld"](7,0,null,0,1,"ion-icon",[["name","chevron-back-outline"]],null,[[null,"click"]],function(e,n,t){var r=!0;return"click"===n&&(r=!1!==e.component.app.back()&&r),r},f.vb,f.u)),r["ɵdid"](8,49152,null,0,h.D,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],{name:[0,"name"]},null),(e()(),r["ɵeld"](9,0,null,0,2,"ion-title",[],null,null,null,f.Zb,f.Y)),r["ɵdid"](10,49152,null,0,h.yb,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],null,null),(e()(),r["ɵted"](-1,0,["村民认证"])),(e()(),r["ɵeld"](12,0,null,null,4,"ion-content",[],null,null,null,f.ob,f.n)),r["ɵdid"](13,49152,null,0,h.v,[r.ChangeDetectorRef,r.ElementRef,r.NgZone],null,null),(e()(),r["ɵand"](16777216,null,0,1,null,S)),r["ɵdid"](15,16384,null,0,A.NgIf,[r.ViewContainerRef,r.TemplateRef],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),(e()(),r["ɵand"](0,[["bindView",2]],0,0,null,T))],function(e,n){var t=n.component;e(n,4,0,"ios"),e(n,8,0,"chevron-back-outline"),e(n,15,0,null==t.normalUserService.belongsAreaList?null:t.normalUserService.belongsAreaList.length,r["ɵnov"](n,16))},null)}function L(e){return r["ɵvid"](0,[(e()(),r["ɵeld"](0,0,null,null,1,"app-bind-belongs-area",[],null,null,null,I,R)),r["ɵdid"](1,245760,null,0,c,[a.a,l.b,b.m,v.b,u.a,s.a,o.a],null,null)],function(e,n){e(n,1,0)},null)}var y=r["ɵccf"]("app-bind-belongs-area",c,L,{},{},[]),C=function(){return function(){}}();t.d(n,"BindBelongsAreaModuleNgFactory",function(){return O});var O=r["ɵcmf"](d,[],function(e){return r["ɵmod"]([r["ɵmpd"](512,r.ComponentFactoryResolver,r["ɵCodegenComponentFactoryResolver"],[[8,[p.a,y]],[3,r.ComponentFactoryResolver],r.NgModuleRef]),r["ɵmpd"](4608,A.NgLocalization,A.NgLocaleLocalization,[r.LOCALE_ID,[2,A["ɵangular_packages_common_common_a"]]]),r["ɵmpd"](4608,h.c,h.c,[r.NgZone,r.ApplicationRef]),r["ɵmpd"](4608,h.Fb,h.Fb,[h.c,r.ComponentFactoryResolver,r.Injector]),r["ɵmpd"](4608,h.Jb,h.Jb,[h.c,r.ComponentFactoryResolver,r.Injector]),r["ɵmpd"](1073742336,A.CommonModule,A.CommonModule,[]),r["ɵmpd"](1073742336,b.n,b.n,[[2,b.s],[2,b.m]]),r["ɵmpd"](1073742336,h.Cb,h.Cb,[]),r["ɵmpd"](1073742336,C,C,[]),r["ɵmpd"](1073742336,d,d,[]),r["ɵmpd"](1024,b.k,function(){return[[{path:"",component:c}]]},[])])})},TN67:function(e,n,t){"use strict";t.d(n,"a",function(){return c}),t.d(n,"b",function(){return d});var r=t("lbwW"),a=t("F/XL"),l=t("15JJ"),i=t("67Y/"),u=t("O0u2"),s=t("atIC"),o=t("CcnG"),c=function(e){return e[e.SELECT_PUBLIC_AREA=0]="SELECT_PUBLIC_AREA",e[e.SHORT_VIDEO_SHARE=1]="SHORT_VIDEO_SHARE",e[e.SHORT_VIDEO_SHARE_STB=2]="SHORT_VIDEO_SHARE_STB",e[e.LIVE_SHARE=3]="LIVE_SHARE",e[e.LIVE_SHARE_STB=4]="LIVE_SHARE_STB",e[e.ARTICLE_PUBLISH_AREA=5]="ARTICLE_PUBLISH_AREA",e[e.SELECT_BELONGS_AREA=6]="SELECT_BELONGS_AREA",e[e.ARTICLE_SHARE=7]="ARTICLE_SHARE",e}({}),d=function(){function e(e,n,t){this.aums=e,this.adminUserService=n,this.app=t,this.userSelectAllArea="",this.userSelectTown="",this.formatAreaTree=[]}return Object.defineProperty(e.prototype,"selectedAreaList",{get:function(){return this._selectedAreaList},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.shareShortVideoAreaTree=null,this.shareLiveAreaTree=null,this.articlePublishAreaTree=null,this.pageCount=1},e.prototype.addSelectedAreaList=function(e,n){void 0===n&&(n=!1),this._selectedAreaList&&!n||(this._selectedAreaList=[]),this._selectedAreaList.push(e)},e.prototype.getList=function(e){var n=this,t=e.areaId,r=e.upLevel;return Object(a.a)(this.businessType).pipe(Object(l.a)(function(e){switch(e){case c.SELECT_PUBLIC_AREA:case c.SELECT_BELONGS_AREA:return n.aums.getAreaList({areaId:t}).pipe(Object(i.a)(function(e){var n=e.data&&e.data.children;return Array.isArray(n)&&n.length?{status:"success",data:n}:Array.isArray(n)?{status:"empty"}:e}));case c.SHORT_VIDEO_SHARE:case c.SHORT_VIDEO_SHARE_STB:return n.getShareShortVideoAreaTree(t);case c.LIVE_SHARE:case c.LIVE_SHARE_STB:return n.getShareLiveAreaTree(r,t);case c.ARTICLE_PUBLISH_AREA:return n.getArticlePublishAreaTree(t);case c.ARTICLE_SHARE:return n.getShareArticleAreaTree(r,t)}}))},e.prototype.getShareShortVideoAreaTree=function(e){var n=this;if(e){var t=this.getChildrenAreaTreeByAreaId(this.shareShortVideoAreaTree,e);return Array.isArray(t)&&t.length?Object(a.a)({status:"success",data:t}):Object(a.a)({status:"error",message:"当前分享区域为空"})}return Object(a.a)(this.adminUserService.user).pipe(Object(l.a)(function(e){return e?n.aums.getShareShortVideoAreaTree({userId:e.id.toString(),userType:n.app.appConfig.aums.userType}).pipe(Object(i.a)(function(e){return"success"===e.status?(n.shareShortVideoAreaTree=n.convertToAreaList(e.data),{status:"success",data:n.shareShortVideoAreaTree}):e})):Object(a.a)({status:"error",message:"管理用户未登录！"})}))},e.prototype.getShareLiveAreaTree=function(e,n){var t=this;if(n){var r=this.getChildrenAreaTreeByAreaId(this.shareLiveAreaTree,n);return Array.isArray(r)&&r.length?Object(a.a)({status:"success",data:r}):Object(a.a)({status:"error",message:"当前分享区域为空"})}return Object(a.a)(this.adminUserService.user).pipe(Object(l.a)(function(n){return n?t.aums.getAreaListByAreaId({regionId:n.areaId,upperLevel:e,lowerLevel:7,needDetailInfo:!0}).pipe(Object(i.a)(function(e){return"success"===e.status?(t.shareLiveAreaTree=t.convertToAreaList(e.data),{status:"success",data:t.shareLiveAreaTree}):e})):Object(a.a)({status:"error",message:"管理用户未登录！"})}))},e.prototype.getShareArticleAreaTree=function(e,n){var t=this;if(n){var r=this.getChildrenAreaTreeByAreaId(this.shareArticleAreaTree,n);return Array.isArray(r)&&r.length?Object(a.a)({status:"success",data:r}):Object(a.a)({status:"error",message:"当前分享区域为空"})}return Object(a.a)(this.adminUserService.user).pipe(Object(l.a)(function(n){return n?t.aums.getAreaListByAreaId({regionId:n.areaId,upperLevel:e,lowerLevel:7,needDetailInfo:!0}).pipe(Object(i.a)(function(e){return"success"===e.status?(t.shareArticleAreaTree=t.convertToAreaList(e.data),{status:"success",data:t.shareArticleAreaTree}):e})):Object(a.a)({status:"error",message:"管理用户未登录！"})}))},e.prototype.getArticlePublishAreaTree=function(e){var n=this;if(e){var t=this.getChildrenAreaTreeByAreaId(this.articlePublishAreaTree,e);return Array.isArray(t)&&t.length?Object(a.a)({status:"success",data:t}):Object(a.a)({status:"error",message:"可发布区域为空"})}return Object(a.a)(this.adminUserService.user).pipe(Object(l.a)(function(e){return e?n.aums.articlePublishAreaTree({areaId:e.areaId}).pipe(Object(i.a)(function(e){return"success"===e.status?(n.articlePublishAreaTree=n.convertToAreaList(e.data[0]),{status:"success",data:n.articlePublishAreaTree}):e})):Object(a.a)({status:"error",message:"管理用户未登录！"})}))},e.prototype.convertToAreaList=function(e){var n,t;if(Array.isArray(e.upperRegion)&&e.upperRegion.length)for(var r=0;r<e.upperRegion.length;r++)0==r?n=[e.upperRegion[r]]:t&&(t.children=[e.upperRegion[r]]),t=e.upperRegion[r];return e.areaId&&e.areaName&&e.areaLevel&&(t?t.children=[{areaName:e.areaName,areaId:e.areaId,areaLevel:e.areaLevel,children:e.lowerRegion||[]}]:n=[{areaName:e.areaName,areaId:e.areaId,areaLevel:e.areaLevel,children:e.lowerRegion||[]}]),e.id&&e.text&&e.level&&(this.formatAreaTree=[],n=[{areaName:e.text,areaId:e.id,areaLevel:e.level,children:this.formatAreaList(e)}]),n},e.prototype.getChildrenAreaTreeByAreaId=function(e,n){var t;if(e)for(var r=0;r<e.length;r++)if(t=e[r].areaId===n?e[r].children:this.getChildrenAreaTreeByAreaId(e[r].children,n))return t;return t},e.prototype.formatAreaList=function(e,n){var t=this;return void 0===n&&(n=this.formatAreaTree),Array.isArray(e.children)&&e.children.length&&e.children.forEach(function(e,r){n.push({areaId:e.id,areaName:e.text,areaLevel:e.level,children:[]}),t.formatAreaList(e,n[r].children)}),this.formatAreaTree},e.ngInjectableDef=o["ɵɵdefineInjectable"]({factory:function(){return new e(o["ɵɵinject"](r.a),o["ɵɵinject"](u.a),o["ɵɵinject"](s.a))},token:e,providedIn:"root"}),e}()}}]);