webpackJsonp([20],{857:function(e,t,l){"use strict";function n(e){return o["ɵvid"](0,[(e()(),o["ɵeld"](0,0,null,null,5,"button",[["color","dark"],["icon-only",""],["ion-button",""],["round",""]],null,[[null,"click"]],function(e,t,l){var n=!0;if("click"===t){n=!1!==e.component.delete()&&n}return n},E.b,E.a)),o["ɵdid"](1,1097728,null,0,R.a,[[8,""],A.a,o.ElementRef,o.Renderer],{color:[0,"color"],round:[1,"round"]},null),(e()(),o["ɵted"](-1,0,["\n      "])),(e()(),o["ɵeld"](3,0,null,0,1,"ion-icon",[["class","iconfont icon-shanchu"],["role","img"]],[[2,"hide",null]],null,null,null,null)),o["ɵdid"](4,147456,null,0,_.a,[A.a,o.ElementRef,o.Renderer],null,null),(e()(),o["ɵted"](-1,0,["\n    "]))],function(e,t){e(t,1,0,"dark","")},function(e,t){e(t,3,0,o["ɵnov"](t,4)._hidden)})}function i(e){return o["ɵvid"](0,[(e()(),o["ɵeld"](0,0,null,null,4,"div",[["class","editor"]],null,null,null,null,null)),(e()(),o["ɵted"](-1,null,["\n    "])),(e()(),o["ɵeld"](2,0,null,null,1,"textarea",[],[[8,"placeholder",0]],[[null,"blur"]],function(e,t,l){var n=!0;if("blur"===t){n=!1!==e.component.outEdit()&&n}return n},null,null)),(e()(),o["ɵted"](3,null,["",""])),(e()(),o["ɵted"](-1,null,["\n  "]))],null,function(e,t){var l=t.component;e(t,2,0,l.editorPlaceholder);e(t,3,0,l.editorValue)})}function a(e){return o["ɵvid"](0,[(e()(),o["ɵeld"](0,0,null,null,15,"ion-slide",[],null,null,null,N.b,N.a)),o["ɵdid"](1,180224,null,0,x.a,[o.ElementRef,o.Renderer,D.a],null,null),(e()(),o["ɵted"](-1,0,["\n      "])),(e()(),o["ɵeld"](3,0,null,0,0,"img",[],[[8,"src",4]],null,null,null,null)),(e()(),o["ɵted"](-1,0,["\n      "])),(e()(),o["ɵeld"](5,0,null,0,9,"div",[["class","photo-info"],["padding",""]],null,null,null,null,null)),(e()(),o["ɵted"](-1,null,["\n        "])),(e()(),o["ɵeld"](7,0,null,null,1,"div",[["class","photos-pager"]],null,null,null,null,null)),(e()(),o["ɵted"](8,null,[""," / ",""])),(e()(),o["ɵted"](-1,null,["\n        "])),(e()(),o["ɵeld"](10,0,null,null,1,"div",[["class","photos-title"]],null,[[null,"click"]],function(e,t,l){var n=!0;if("click"===t){n=!1!==e.component.edit("title")&&n}return n},null,null)),(e()(),o["ɵted"](11,null,["",""])),(e()(),o["ɵted"](-1,null,["\n        "])),(e()(),o["ɵeld"](13,0,null,null,0,"div",[["class","photo-des"]],[[8,"innerHTML",1]],[[null,"click"]],function(e,t,l){var n=!0;if("click"===t){n=!1!==e.component.edit("des")&&n}return n},null,null)),(e()(),o["ɵted"](-1,null,["\n      "])),(e()(),o["ɵted"](-1,0,["\n    "]))],null,function(e,t){var l=t.component;e(t,3,0,o["ɵinlineInterpolate"](1,"",t.context.$implicit.photo,""));e(t,8,0,l.currentSlideIndex+1,null==l.slides?null:l.slides.length);e(t,11,0,l.title);e(t,13,0,l.sanitizer.bypassSecurityTrustHtml(t.context.$implicit.des))})}function s(e){return o["ɵvid"](0,[o["ɵqud"](402653184,1,{slidesComp:0}),(e()(),o["ɵted"](-1,null,["\n"])),(e()(),o["ɵeld"](2,0,null,null,19,"ion-header",[],null,null,null,null,null)),o["ɵdid"](3,16384,null,0,V.a,[A.a,o.ElementRef,o.Renderer,[2,G.a]],null,null),(e()(),o["ɵted"](-1,null,["\n  "])),(e()(),o["ɵeld"](5,0,null,null,15,"ion-navbar",[["class","toolbar"]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,O.b,O.a)),o["ɵdid"](6,49152,null,0,U.a,[L.a,[2,G.a],[2,F.a],A.a,o.ElementRef,o.Renderer],null,null),(e()(),o["ɵted"](-1,3,["\n    "])),(e()(),o["ɵeld"](8,0,null,3,2,"ion-title",[],null,null,null,M.b,M.a)),o["ɵdid"](9,49152,null,0,j.a,[A.a,o.ElementRef,o.Renderer,[2,J.a],[2,U.a]],null,null),(e()(),o["ɵted"](10,0,["\n      ","\n    "])),(e()(),o["ɵted"](-1,3,["\n    "])),(e()(),o["ɵeld"](12,0,null,2,7,"ion-buttons",[["end",""]],null,null,null,null,null)),o["ɵdid"](13,16384,null,1,W.a,[A.a,o.ElementRef,o.Renderer,[2,J.a],[2,U.a]],null,null),o["ɵqud"](603979776,2,{_buttons:1}),(e()(),o["ɵted"](-1,null,["\n      "])),(e()(),o["ɵeld"](16,0,null,null,2,"button",[["clear",""],["ion-button",""],["large",""]],null,[[null,"click"]],function(e,t,l){var n=!0;if("click"===t){n=!1!==e.component.publish()&&n}return n},E.b,E.a)),o["ɵdid"](17,1097728,[[2,4]],0,R.a,[[8,""],A.a,o.ElementRef,o.Renderer],{large:[0,"large"],clear:[1,"clear"]},null),(e()(),o["ɵted"](-1,0,["\n        发布\n      "])),(e()(),o["ɵted"](-1,null,["\n    "])),(e()(),o["ɵted"](-1,3,["\n  "])),(e()(),o["ɵted"](-1,null,["\n"])),(e()(),o["ɵted"](-1,null,["\n\n"])),(e()(),o["ɵeld"](23,0,null,null,30,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null],[2,"has-infinite-scroll",null]],null,null,B.b,B.a)),o["ɵdid"](24,4374528,null,0,z.a,[A.a,K.a,Y.a,o.ElementRef,o.Renderer,L.a,H.a,o.NgZone,[2,G.a],[2,F.a]],null,null),(e()(),o["ɵted"](-1,1,["\n  "])),(e()(),o["ɵeld"](26,0,null,1,16,"div",[["class","actions"]],null,null,null,null,null)),(e()(),o["ɵted"](-1,null,["\n    "])),(e()(),o["ɵand"](16777216,null,null,1,null,n)),o["ɵdid"](29,16384,null,0,q.NgIf,[o.ViewContainerRef,o.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),o["ɵted"](-1,null,["\n    "])),(e()(),o["ɵeld"](31,0,null,null,10,"div",[["class","upload-file"]],null,null,null,null,null)),(e()(),o["ɵted"](-1,null,["\n      "])),(e()(),o["ɵeld"](33,0,null,null,0,"input",[["accept","image/*"],["type","file"]],null,[[null,"change"]],function(e,t,l){var n=!0;if("change"===t){n=!1!==e.component.changeImage(l)&&n}return n},null,null)),(e()(),o["ɵted"](-1,null,["\n      "])),(e()(),o["ɵeld"](35,0,null,null,5,"button",[["color","dark"],["icon-only",""],["ion-button",""],["round",""]],null,null,null,E.b,E.a)),o["ɵdid"](36,1097728,null,0,R.a,[[8,""],A.a,o.ElementRef,o.Renderer],{color:[0,"color"],round:[1,"round"]},null),(e()(),o["ɵted"](-1,0,["\n        "])),(e()(),o["ɵeld"](38,0,null,0,1,"ion-icon",[["class","iconfont icon-tupian"],["role","img"]],[[2,"hide",null]],null,null,null,null)),o["ɵdid"](39,147456,null,0,_.a,[A.a,o.ElementRef,o.Renderer],null,null),(e()(),o["ɵted"](-1,0,["\n      "])),(e()(),o["ɵted"](-1,null,["\n    "])),(e()(),o["ɵted"](-1,null,["\n  "])),(e()(),o["ɵted"](-1,1,["\n  "])),(e()(),o["ɵand"](16777216,null,1,1,null,i)),o["ɵdid"](45,16384,null,0,q.NgIf,[o.ViewContainerRef,o.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),o["ɵted"](-1,1,["\n  "])),(e()(),o["ɵeld"](47,0,null,1,5,"ion-slides",[],null,[[null,"ionSlideWillChange"],[null,"ionSlideDidChange"]],function(e,t,l){var n=!0,i=e.component;if("ionSlideWillChange"===t){n=!1!==i.ionSlideWillChange()&&n}if("ionSlideDidChange"===t){n=!1!==i.ionSlideDidChange()&&n}return n},Z.b,Z.a)),o["ɵdid"](48,1228800,[[1,4]],0,D.a,[A.a,K.a,o.NgZone,[2,G.a],o.ElementRef,o.Renderer],null,{ionSlideWillChange:"ionSlideWillChange",ionSlideDidChange:"ionSlideDidChange"}),(e()(),o["ɵted"](-1,0,["\n    "])),(e()(),o["ɵand"](16777216,null,0,1,null,a)),o["ɵdid"](51,802816,null,0,q.NgForOf,[o.ViewContainerRef,o.TemplateRef,o.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),o["ɵted"](-1,0,["\n  "])),(e()(),o["ɵted"](-1,1,["\n"])),(e()(),o["ɵted"](-1,null,["\n"]))],function(e,t){var l=t.component;e(t,17,0,"","");var n=null;e(t,29,0,null==(n=l.getCurrentSlide())?null:n.added);e(t,36,0,"dark","");e(t,45,0,l.editable);e(t,51,0,l.slides)},function(e,t){var l=t.component;e(t,5,0,o["ɵnov"](t,6)._hidden,o["ɵnov"](t,6)._sbPadding);e(t,10,0,l.columnName);e(t,23,0,o["ɵnov"](t,24).statusbarPadding,o["ɵnov"](t,24)._hasRefresher,o["ɵnov"](t,24)._hasInfiniteScroll);e(t,38,0,o["ɵnov"](t,39)._hidden)})}Object.defineProperty(t,"__esModule",{value:!0});var o=l(1),r=(l(0),l(61),l(20)),u=l(23),d=l(27),c=l(26),h=l(41),p=l(3),g=l(953),f=l(196),m=function(){function e(e,t,l,n,i,a,s,o,r,u){this.navCtrl=e,this.navParams=t,this.loadingCtrl=l,this.sanitizer=n,this.toastCtrl=i,this.logger=a,this.aums=s,this.utils=o,this.appProvider=r,this.adminUserProvider=u,this.editable=!1,this.defaultTitle="添加图集标题",this.defaultSlide={photo:"assets/common/publish-photo-default.png",des:"添加图片描述信息",added:!1,id:0,url:""},this.slides=[],this.isUploading=!1,this._columnName=this.navParams.get("columnName"),this._type=this.navParams.get("type"),this._columnId=this.navParams.get("columnId"),this._websiteId=this.navParams.get("websiteId"),this._publishpower=this.navParams.get("publishpower"),this._articleId=this.navParams.get("articleId"),this.switchMode=!this._articleId}return t=e,Object.defineProperty(e.prototype,"columnName",{get:function(){return this._columnName},enumerable:!0,configurable:!0}),e.prototype.ionViewDidLoad=function(){var e=this;this.appProvider.closeToast(),this._articleId?this.aums.getArticle({id:this._articleId,typeid:2},this.adminUserProvider.getApiEndPoint()).subscribe(function(t){var l,n=[];1==t.isSuccess?(l=t.article.ftitle,Array.isArray(t.ArticleRelation)&&(t.ArticleRelation.forEach(function(e){n.push({photo:e.adescride,des:e.atext,added:!0,id:e.id,url:e.adescride})}),n.push(Object.create(e.defaultSlide))),e.title=l||e.defaultTitle,e.slides=n.length?n:[Object.create(e.defaultSlide)],e.currentSlideIndex=0):(e.utils.toast(t.message||"加载图集失败，请稍后再试!","bottom","evm-toast"),e.navCtrl.pop())}):(this.slides.push(Object.assign({},this.defaultSlide)),this.title=this.defaultTitle,this.currentSlideIndex=this.slides.length-1)},e.prototype.ionSlideWillChange=function(){this.log("info","ionSlideWillChange() currentSlideIndex = "+this.currentSlideIndex),this.appProvider.closeToast()},e.prototype.ionSlideDidChange=function(){var e=this.slidesComp.getActiveIndex(),t=!1;e>=this.slides.length&&(t=!0,this.slidesComp._activeIndex=this.slides.length-1,e=this.slides.length-1),this.log("info","ionSlideDidChange() activeIndex = "+e),this.currentSlideIndex=e,!this.getCurrentSlide().added&&t&&(this.appProvider.closeToast(),this.utils.toast("点击图片按钮添加当前页图片","bottom","evm-toast light"))},e.prototype.ionViewWillLeave=function(){this.appProvider.closeActionSheet(),this.appProvider.closeLoading()},e.prototype.changeImage=function(e){var t=this;if(!this.isUploading){this.isUploading=!0;var l=e.target.value,n=e.target.files;if(l){this.log("info","changeImage() 上传图片路径: "+l);l.substr(l.lastIndexOf(".")+1);var i=n[0];this.appProvider.loadingInstance=this.loadingCtrl.create({content:"图片上传中...",spinner:"dots"}),this.appProvider.loadingInstance.present(),this.aums.uploadImage({name:"图集上传",imgFile:i,userId:this.adminUserProvider.user.id.toString()},this.adminUserProvider.getApiEndPoint()).subscribe(function(e){t.log("info","changeImage() uploadImage response: "+JSON.stringify(e)),e&&e.data&&e.data.url?(t.getCurrentSlide().photo=e.data.url,t.getCurrentSlide().added=!0,t.getCurrentSlide().id=e.data.id,t.getCurrentSlide().url=e.data.url,t.updateSlides(),t.isUploading=!1):(t.isUploading=!1,t.utils.toast(e.message||"图片上传失败，请稍后再试!","bottom","evm-toast light"))},function(){},function(){e.target.value=null,t.appProvider.closeLoading()})}}},e.prototype.updateSlides=function(){this.slides.push(Object.assign({},this.defaultSlide)),this.slidesComp.update()},e.prototype.log=function(e,l){this.logger[e](t.TAG+" "+l)},e.prototype.getCurrentSlide=function(){return this.slides[this.currentSlideIndex]},e.prototype.resetEditor=function(){this.editable=!1,this.editorValue=null,this.editorType=null},e.prototype.edit=function(e){var t=this;switch(this.editable=!0,this.editorType=e,e){case"title":this.editorPlaceholder=this.defaultTitle,this.title!==this.defaultTitle&&(this.editorValue=this.unformat(this.title));break;case"des":this.editorPlaceholder=this.defaultSlide.des;var l=this.getCurrentSlide();l.des!=this.defaultSlide.des&&(this.editorValue=this.unformat(l.des))}setTimeout(function(){var e=t.getEditorArea();e&&e.focus()})},e.prototype.getEditorArea=function(){return document.querySelector("page-publish-photos .editor textarea")},e.prototype.outEdit=function(){var e=this.format(this.getEditorArea().value);switch(this.editorType){case"title":this.title=e||this.defaultTitle;break;case"des":this.getCurrentSlide().des=e||this.defaultSlide.des}this.resetEditor()},e.prototype.delete=function(){var e=this.getCurrentSlide();1===this.slides.length?Object.assign(e,this.defaultSlide):this.slides.splice(this.currentSlideIndex,1),this.slidesComp.update()},e.prototype.publish=function(){var e=this;if(this.title&&this.title!==this.defaultTitle)if(this.slides&&0!==this.slides.length&&!1!==this.slides[0].added){var t=[];this.slides.filter(function(e){return!0===e.added}).forEach(function(e){t.push({type:"img",imgid:e.id,description:e.url,domid:"图集图片",atext:e.des,aenabeled:1,id:""})});this.aums.post({id:this._articleId,ftitle:this.title,fcontent:null,fsummary:null,websiteid:this._websiteId,columnid:this._columnId,userId:this.adminUserProvider.user.id,fimage:this.slides[0].id,areaid:this.adminUserProvider.user.areaId,publishpower:this._publishpower,temArray:JSON.stringify(t),ftypeid:2},this.adminUserProvider.getApiEndPoint()).subscribe(function(t){t&&1==t.isSuccess?(e.appProvider.updateManagerPostItem(e.title,p().format("YYYY-MM-DD"),e.slides[0].photo),e._articleId||e.appProvider.setGlobalVar(g.a.TAG,"add"),e.utils.toast("图集发布成功!","bottom","evm-toast"),e.navCtrl.pop()):e.utils.toast("图集发布失败，请稍后重试!","bottom","evm-toast light")},function(t){e.utils.toast("图集发布失败，请稍后重试!","bottom","evm-toast light")})}else this.utils.toast("图集必须上传一张图片","bottom","evm-toast light");else this.utils.toast("图集标题不能为空","bottom","evm-toast light")},e.prototype.format=function(e){return e?e.replace(/\n/gi,"<br>"):e},e.prototype.unformat=function(e){return e?e.replace(/<br>/gi,"\n"):e},e.TAG="PublishPhotosPage",e;var t}(),b=function(){return function(){}}(),v=l(504),I=l(505),y=l(506),P=l(507),C=l(508),w=l(509),S=l(510),T=l(511),k=l(512),E=l(46),R=l(32),A=l(4),_=l(62),N=l(869),x=l(197),D=l(126),V=l(128),G=l(8),O=l(865),U=l(55),L=l(15),F=l(37),M=l(515),j=l(91),J=l(57),W=l(130),B=l(514),z=l(38),K=l(7),Y=l(14),H=l(47),q=l(17),Z=l(870),$=l(18),Q=l(136),X=l(138),ee=o["ɵcrt"]({encapsulation:2,styles:[],data:{}}),te=o["ɵccf"]("page-publish-photos",m,function(e){return o["ɵvid"](0,[(e()(),o["ɵeld"](0,0,null,null,1,"page-publish-photos",[],null,null,null,s,ee)),o["ɵdid"](1,49152,null,0,m,[F.a,$.a,Q.a,h.c,X.a,u.b,d.a,c.a,r.a,f.a],null,null)],null,null)},{},{},[]),le=l(31),ne=l(195),ie=l(63);l.d(t,"PublishPhotosPageModuleNgFactory",function(){return ae});var ae=o["ɵcmf"](b,[],function(e){return o["ɵmod"]([o["ɵmpd"](512,o.ComponentFactoryResolver,o["ɵCodegenComponentFactoryResolver"],[[8,[v.a,I.a,y.a,P.a,C.a,w.a,S.a,T.a,k.a,te]],[3,o.ComponentFactoryResolver],o.NgModuleRef]),o["ɵmpd"](4608,q.NgLocalization,q.NgLocaleLocalization,[o.LOCALE_ID,[2,q["ɵa"]]]),o["ɵmpd"](4608,le.v,le.v,[]),o["ɵmpd"](4608,le.d,le.d,[]),o["ɵmpd"](512,q.CommonModule,q.CommonModule,[]),o["ɵmpd"](512,le.t,le.t,[]),o["ɵmpd"](512,le.j,le.j,[]),o["ɵmpd"](512,le.r,le.r,[]),o["ɵmpd"](512,ne.a,ne.a,[]),o["ɵmpd"](512,ne.b,ne.b,[]),o["ɵmpd"](512,b,b,[]),o["ɵmpd"](256,ie.a,m,[])])})},865:function(e,t,l){"use strict";function n(e){return i["ɵvid"](0,[(e()(),i["ɵeld"](0,0,null,null,1,"div",[["class","toolbar-background"]],null,null,null,null,null)),i["ɵdid"](1,278528,null,0,a.NgClass,[i.IterableDiffers,i.KeyValueDiffers,i.ElementRef,i.Renderer2],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),(e()(),i["ɵeld"](2,0,null,null,8,"button",[["class","back-button"],["ion-button","bar-button"]],[[8,"hidden",0]],[[null,"click"]],function(e,t,l){var n=!0;if("click"===t){n=!1!==e.component.backButtonClick(l)&&n}return n},s.b,s.a)),i["ɵdid"](3,278528,null,0,a.NgClass,[i.IterableDiffers,i.KeyValueDiffers,i.ElementRef,i.Renderer2],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),i["ɵdid"](4,1097728,null,0,o.a,[[8,"bar-button"],r.a,i.ElementRef,i.Renderer],null,null),(e()(),i["ɵeld"](5,0,null,0,2,"ion-icon",[["class","back-button-icon"],["role","img"]],[[2,"hide",null]],null,null,null,null)),i["ɵdid"](6,278528,null,0,a.NgClass,[i.IterableDiffers,i.KeyValueDiffers,i.ElementRef,i.Renderer2],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),i["ɵdid"](7,147456,null,0,u.a,[r.a,i.ElementRef,i.Renderer],{name:[0,"name"]},null),(e()(),i["ɵeld"](8,0,null,0,2,"span",[["class","back-button-text"]],null,null,null,null,null)),i["ɵdid"](9,278528,null,0,a.NgClass,[i.IterableDiffers,i.KeyValueDiffers,i.ElementRef,i.Renderer2],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),(e()(),i["ɵted"](10,null,["",""])),i["ɵncd"](null,0),i["ɵncd"](null,1),i["ɵncd"](null,2),(e()(),i["ɵeld"](14,0,null,null,2,"div",[["class","toolbar-content"]],null,null,null,null,null)),i["ɵdid"](15,278528,null,0,a.NgClass,[i.IterableDiffers,i.KeyValueDiffers,i.ElementRef,i.Renderer2],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),i["ɵncd"](null,3)],function(e,t){var l=t.component;e(t,1,0,"toolbar-background","toolbar-background-"+l._mode);e(t,3,0,"back-button","back-button-"+l._mode);e(t,6,0,"back-button-icon","back-button-icon-"+l._mode);e(t,7,0,l._bbIcon);e(t,9,0,"back-button-text","back-button-text-"+l._mode);e(t,15,0,"toolbar-content","toolbar-content-"+l._mode)},function(e,t){var l=t.component;e(t,2,0,l._hideBb);e(t,5,0,i["ɵnov"](t,7)._hidden);e(t,10,0,l._backText)})}l.d(t,"a",function(){return d}),t.b=n;var i=l(1),a=l(17),s=l(46),o=l(32),r=l(4),u=l(62),d=(l(8),l(37),i["ɵcrt"]({encapsulation:2,styles:[],data:{}}))},869:function(e,t,l){"use strict";function n(e){return i["ɵvid"](2,[(e()(),i["ɵeld"](0,0,null,null,1,"div",[["class","slide-zoom"]],null,null,null,null,null)),i["ɵncd"](null,0)],null,null)}l.d(t,"a",function(){return a}),t.b=n;var i=l(1),a=i["ɵcrt"]({encapsulation:2,styles:[],data:{}})},870:function(e,t,l){"use strict";function n(e){return i["ɵvid"](2,[(e()(),i["ɵeld"](0,0,null,null,3,"div",[["class","swiper-container"]],[[1,"dir",0]],null,null,null,null)),(e()(),i["ɵeld"](1,0,null,null,1,"div",[["class","swiper-wrapper"]],null,null,null,null,null)),i["ɵncd"](null,0),(e()(),i["ɵeld"](3,0,null,null,0,"div",[["class","swiper-pagination"]],[[2,"hide",null]],null,null,null,null))],null,function(e,t){var l=t.component;e(t,0,0,l._rtl?"rtl":null);e(t,3,0,!l.pager)})}l.d(t,"a",function(){return a}),t.b=n;var i=l(1),a=(l(4),l(7),l(8),i["ɵcrt"]({encapsulation:2,styles:[],data:{}}))},941:function(e,t,l){"use strict";l.d(t,"a",function(){return n});var n={live:{type:"live",code:1,name:"直播"},villageBroad:{type:"villageBroad",code:2,name:"乡村广播"},townBroad:{type:"townBroad",code:3,name:"乡镇广播"}}},943:function(e,t,l){"use strict";l.d(t,"a",function(){return a});l(0);var n=l(1),i=(l(26),l(20),l(194),l(27),l(61),l(88),l(42)),a=(l(196),function(){function e(e,t,l,i,a,s,o,r){this.utils=e,this.logger=t,this.pageTipProvider=l,this.aumsApi=i,this.aums=a,this.app=s,this.nativeJsExtend=o,this.adminUserProvider=r,this.onClickItem=new n.EventEmitter,this.onEdit=new n.EventEmitter,this.pageIndex=1,this.isInfiniting=!1}return t=e,e.prototype.ngOnChanges=function(e){var l=e.id,n=JSON.stringify(l.currentValue),i=JSON.stringify(l.previousValue);this.logger.debug(t.TAG+" ngOnChanges() currentValue: "+n),this.logger.debug(t.TAG+" ngOnChanges() previousValue: "+i),n!==i&&(this.logger.debug(t.TAG+" ngOnChanges() this.id: "+this.id),this.load())},e.prototype.load=function(e){var l=this;this.id&&(this.pageTipShow=this.pageTipProvider.loadingInstance().show,this.pageTipData=this.pageTipProvider.loadingInstance().data,this.infiniteScroller&&this.infiniteScroller.enable(!0),this.aums.getCommonList({columnId:this.id,curPage:1,areaId:this.adminUserProvider.user.areaId,userId:this.adminUserProvider.user.id,checkFlag:2},this.adminUserProvider.getApiEndPoint()).subscribe(function(n){Array.isArray(n)&&n.length?(l.pageTipShow=l.pageTipProvider.successInstance().show,l.pageTipData=l.pageTipProvider.successInstance().data,l.logger.debug(t.TAG+" load() get common list: "+JSON.stringify(n)),l.list=n,l.pageIndex++):(l.pageTipShow=l.pageTipProvider.emptyInstance().show,l.pageTipData=l.pageTipProvider.emptyInstance().data),e&&e("success")},function(t){var n=l.pageTipProvider.instanceFatory(t.status);l.pageTipShow=n.show,l.pageTipData=n.data,e&&e("error")}))},e.prototype.doInfinite=function(e){var t=this;this.isInfiniting||(this.isInfiniting=!0,this.aums.getCommonList({columnId:this.id,curPage:this.pageIndex,areaId:this.adminUserProvider.user.areaId,userId:this.adminUserProvider.user.id,checkFlag:2},this.adminUserProvider.getApiEndPoint()).subscribe(function(l){Array.isArray(l)&&l.length?(t.list=t.list.concat(l),t.pageIndex++):(e.enable(!1),t.loadListTip="没有更多了")},function(e){},function(){e.complete(),t.isInfiniting=!1}))},e.prototype.imgLoadError=function(e,l){this.logger.error(t.TAG+" 加载图片失败(imageUrl=>"+e.target.src+")"),setTimeout(function(){l.loadThumbnailError=!0},0)},e.prototype.openItem=function(e){this.onClickItem.emit(e.raw)},e.prototype.edit=function(e,t){e.stopPropagation(),this.onEdit.emit(t)},e.prototype.check=function(e,t){var l=this;e.stopPropagation();var n=1==t.raw.checkFlag?0:1;this.aumsApi.updateCheckFlag({articleIds:t.id,articleColumnId:t.raw.columnId,checkFlag:n},this.adminUserProvider.getApiEndPoint()).subscribe(function(e){1==e.isSuccess?t.raw.checkFlag=n:l.utils.toast("修改状态失败，请稍后再试")})},e.prototype.share=function(e,t){this.nativeJsExtend.startActivity(i.a.ACTIVITY_SHARE,this.app.apache.apiEndPoint+"/"+this.app.apache.path+"/#/article/"+t.id)},e.prototype.filterInfo=function(e){return/^[a-zA-Z]/.test(e)?"":e},e.prototype.trackById=function(e,t){return t.id},e.prototype.refreshPage=function(){this.pageIndex=1,this.load()},e.TAG="ManagerPostEditListPage ",e;var t}())},953:function(e,t,l){"use strict";l.d(t,"a",function(){return s});l(0),l(61),l(27),l(26);var n=l(95),i=(l(20),l(941)),a=(l(943),l(220)),s=(l(88),l(196),function(){function e(e,l,n,i,a,s,o,r,u){this.navCtrl=e,this.navParams=l,this.popoverCtrl=n,this.aumsApiProvider=i,this.aums=a,this.utils=s,this.logger=o,this.app=r,this.adminUserProvider=u,this.list=[],this.pageIndex=1,this.cId=+this.navParams.get("columnId"),this.name=this.navParams.get("columnName"),this.websiteId=+this.navParams.get("websiteId"),this.publishpower=+this.navParams.get("publishpower"),this.logger.info(t.TAG+" cId="+this.cId),this.logger.info(t.TAG+" name="+this.name)}return t=e,e.prototype.ionViewDidLoad=function(){},e.prototype.ionViewWillEnter=function(){this.app.managerPostItem&&this.logger.debug(t.TAG+" ionViewWillEnter() managerPostItem: "+JSON.stringify(this.app.managerPostItem)),"add"===this.app.getGlobalVar(t.TAG)&&(this.app.setGlobalVar(t.TAG,null),this.reload())},e.prototype.openCommonListItem=function(e){this.logger.info(t.TAG+" openCommonListItem() 点击文章列表项")},e.prototype.onEdit=function(e){this.app.managerPostItem=e;var t=void 0,l=void 0;2===e.raw.ftypeid&&1===e.raw.aorvtype?(t="publish-photos",l=n.b):2===e.raw.aorvtype?(t="publish-vote-subject",l=n.c):(t="publish",l=n.a),this.navCtrl.push(t,{columnName:this.name,type:l,columnId:this.cId,websiteId:this.websiteId,publishpower:this.publishpower,articleId:e.raw.articleId})},e.prototype.add=function(e){var l=this;switch(this.name){case"本村广播":case"乡镇广播":this.aumsApiProvider.getHostInfo({userId:this.adminUserProvider.user.id.toString()}).subscribe(function(e){e.success&&e.isPublishDevice&&e.checkFlag&&e.isCheck?l.navCtrl.push("publish-live",{type:"本村广播"===l.name?i.a.villageBroad.type:i.a.townBroad.type}):(l.logger.warn(t.TAG+" onPublish() get host info: "+JSON.stringify(e)),l.utils.toast("您没有权限发布乡村广播"))},function(e){l.logger.error(t.TAG+" onPublish() get host info error: "+e.message),l.utils.toast("您没有权限发布乡村广播")});break;default:this.presentArticleTypeSelect(e)}},e.prototype.reload=function(){this.managerPostEditListPage.refreshPage()},e.prototype.presentArticleTypeSelect=function(e){var l=this,i=this.popoverCtrl.create(a.a,{},{cssClass:"article-type-select"});i.present(),i.onDidDismiss(function(e){switch(l.app.setGlobalVar(t.TAG,"add"),e){case n.a:l.navCtrl.push("publish",{columnName:l.name,type:n.a,columnId:l.cId,websiteId:l.websiteId,publishpower:l.publishpower,articleId:0});break;case n.b:l.navCtrl.push("publish-photos",{columnName:l.name,type:n.b,columnId:l.cId,websiteId:l.websiteId,publishpower:l.publishpower,articleId:0});break;case n.c:l.navCtrl.push("publish-vote-subject",{columnName:l.name,type:n.c,columnId:l.cId,websiteId:l.websiteId,publishpower:l.publishpower,articleId:0})}})},e.TAG="ManagerPostListPage",e;var t}())}});